Title: DIY家用NAS之硬件篇
Date: 2011-10-08 14:40
Author: ahui
Category: Linux, 网络
Tags: blog, Linux, Network, sofeware
Slug: diy_nas_hw

一则硬盘空间一直比较紧张,二则现在硬盘质量不再象以前那么可靠,数据容易丢失,于是计划购置一个能做阵列的家用NAS机器.
仔细研究了一下国内外不少品牌或山寨的NAS,最后比较满意希捷BlackArmor NAS
400系列.
可惜的是国内一直没有售,而且价格好象也悄悄涨过一次,不带硬盘拿下来也得3K多了.

既然现成的不满意,就自己配一个好了.

想要达到的目的:  
1.整机加4块左右硬盘的功耗要控制在50W左右.  
2.至少要能上4块硬盘,最好能升级到8块左右硬盘.能做RAID 5.  
3.千兆网络环境下,要有60MB/s的上下传速率.  
4.除了能做NAS,还要能增加SVN server之类的应用.  
5.有可能做HTPC,这样得有一个过得去的显卡或者至少有hdmi输出.  
6.噪音尽量小.  
7.不带硬盘价格控制在2K以下

本来先考虑的atom平台,cpu功耗相当小,可惜加上对应的主板后就难看了点.
然后只能转向amd apu系列.
RAID5要消耗比较多的CPU资源,因此E350的性能要好得多.
再查询E350整合主板,品牌牌子有GIGABYTE和ASUS二家.此外梅捷,七彩虹都有类似的主板.
另外这类主板主要分二类,一是只有USB2以及SATA3G的,二是带USB3以及SATA6G的.显然后者参数要美妙得多.

1.技嘉（GIGABYTE）GA-E350N-USB3, 1.6G双核CPU,集成HD 6310显卡,2USB3,4 SATA
6G,CPU带风扇. 功耗约22w. 699大洋.  
2.Asus APU E35M1-M PRO FUSION,1.6G双核CPU,集成HD 6310显卡,2USB3,5 SATA
6G,1 ESATA 6G,静音设计,无风扇. 功耗约22w. 1299大洋.  

这二块入眼的主板其实本不用考虑选哪个,ASUS的5SATA,无风扇设计,简直就是为NAS设计的.
可我还是纠结了二天才确定下来,因为ASUS的要1299块,TB也得1100+,而GIGABYTE的只要699块啊\~,于是我决定用699块的.除了我一向勤俭节约外,主要还是考虑万一配出来的NAS不满意,这不就能减少不少损失么......当然前期4块硬盘也足够使用了.
至于那个明显是噪音制造者的CPU风扇,我就当没看见好了.

机箱有大小二种选择,小机箱省地,大机箱散热和扩展性要好不少.
我觉得4块硬盘挤一起,那热量也挺吓人的,还是用大点的机箱好了.  
电源得配个好点的.烧主板烧硬盘的电源,碰到过不少.
查了一下JD上的存货,配了TT的机箱+电源:  
1.TT 金刚500高效电源,5SATA电源头,带14cm风扇一个.299大洋.  
2.TT Commander MS-I指挥官居中塔机箱,7HD位. 带12cm风扇一个.279大洋.

主板最高支持8G内存,考虑到要使用ZFS文件系统,要求最少6G内存,这样内存得上满,好在现在这东西非常便宜.  
1.Samsung 三星 金条 DDR3 1066 4G x2, 275大洋.  
原有一块2T WD绿盘,再购置二块同型号硬盘. 花费998大洋.  
这样总计花费,不算硬盘约1500块,DIY出一个8G内存,1.6G双核CPU,4个SATA
6G接口,2个USB3接口的家用NAS. 相当超值了.

所有硬件分别采购于JD,新蛋,易讯三家.
早上9点前下的订单,当天下午JD送到一部分,易讯送到.第二天上午JD送完剩下的,新蛋送到.
大体可见三家物流的情况.

到手后主板要处理一下. CPU的散热片要拆下来,是个二层结构.
在二层金属片接触的地方,只是象征性的涂了不到一平方厘米的硅胶.
买管硅胶,恶狠狠地把它涂满吧\~ 不然开机时间一长,CPU/GPU的温度会很高.
而且主板四个SATA接口,只配了二根SATA硬盘线, 在此BS一下GIGABYTE的偷工减料.

硬件安装好后一次点亮, 不接硬盘,按下电源开机时有个100W+的瞬时功耗,
然后稳定在33W左右. 进BIOS把内置显卡频率下调到300M.能减少2W功耗.
这样不带硬盘功耗在31W左右.  
加上三块硬盘,待机时功耗增加9W左右,全机约38W\~40W, RAID
5读写时功耗增加10\~20W左右,全机功耗50W\~59W,基本上没超过60W.
虽然还是嫌功耗稍高了点,总体来说还是能够接受, 毕竟大多数时间还是待机,
不到40W的功耗也算是看得过去了.

下篇再说说NAS系统软件的选择与安装.
